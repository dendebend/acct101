<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACCT101 - Complete Accounting Cycle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
        }

        h1 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 25px;
            font-size: 1.1em;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .step-indicator {
            flex: 1;
            min-width: 120px;
            padding: 15px 10px;
            text-align: center;
            background: #e5e7eb;
            border-radius: 8px;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .step-indicator.active {
            background: #3b82f6;
            color: white;
            transform: scale(1.05);
        }

        .step-indicator.completed {
            background: #10b981;
            color: white;
        }

        .step-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .step-header h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .step-header p {
            opacity: 0.9;
        }

        .transaction-list {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .transaction-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3b82f6;
            border-radius: 5px;
        }

        .transaction-date {
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 5px;
        }

        .journal-entry-builder {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .entry-row {
            display: grid;
            grid-template-columns: 80px 2fr 150px;
            gap: 15px;
            align-items: center;
            margin: 10px 0;
        }

        .entry-label {
            font-weight: 700;
            color: #374151;
        }

        select, input[type="number"] {
            padding: 10px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 1em;
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.05em;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .ledger-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .t-account {
            background: #f9fafb;
            border: 3px solid #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }

        .t-account-header {
            background: #8b5cf6;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 700;
        }

        .t-account-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 150px;
            max-height: 400px;
        }

        .debit-side, .credit-side {
            padding: 12px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .debit-side {
            border-right: 3px solid #e5e7eb;
        }

        /* Custom scrollbar styling for T-accounts */
        .debit-side::-webkit-scrollbar, .credit-side::-webkit-scrollbar {
            width: 8px;
        }

        .debit-side::-webkit-scrollbar-track, .credit-side::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .debit-side::-webkit-scrollbar-thumb, .credit-side::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }

        .debit-side::-webkit-scrollbar-thumb:hover, .credit-side::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }

        .side-label {
            font-weight: 700;
            color: #6b7280;
            margin-bottom: 8px;
            font-size: 0.85em;
        }

        .ledger-entry {
            padding: 5px;
            margin: 3px 0;
            background: white;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .ledger-input-row {
            display: flex;
            gap: 5px;
            margin: 5px 0;
            align-items: center;
        }

        .ledger-input-row input {
            flex: 1;
            padding: 5px;
            font-size: 0.85em;
        }

        .ledger-input-row label {
            font-size: 0.8em;
            color: #6b7280;
        }

        .trial-balance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .trial-balance-table th {
            background: #3b82f6;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .trial-balance-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .trial-balance-table tr:hover {
            background: #f3f4f6;
        }

        .total-row {
            font-weight: 700;
            background: #eff6ff !important;
            border-top: 3px solid #3b82f6;
        }

        .tb-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .feedback.success {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
        }

        .feedback.error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }

        .feedback.info {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            color: #1e40af;
        }

        .fs-section {
            background: #f9fafb;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .fs-line {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            align-items: center;
        }

        .fs-line input {
            width: 150px;
            text-align: right;
        }

        @media (max-width: 768px) {
            .entry-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .progress-steps {
                flex-direction: column;
            }

            .step-indicator {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Complete Accounting Cycle</h1>
        <p class="subtitle">Follow all 7 steps from transactions to financial statements!</p>

        <div style="text-align: center; margin-bottom: 20px;">
            <button class="btn btn-secondary" onclick="resetScenario()">üîÑ New Scenario</button>
        </div>

        <div class="progress-steps">
            <div class="step-indicator active" onclick="goToStep(1)">
                Step 1<br>Transactions
            </div>
            <div class="step-indicator" onclick="goToStep(2)">
                Step 2<br>Journal Entries
            </div>
            <div class="step-indicator" onclick="goToStep(3)">
                Step 3<br>Ledger
            </div>
            <div class="step-indicator" onclick="goToStep(4)">
                Step 4<br>Trial Balance
            </div>
            <div class="step-indicator" onclick="goToStep(5)">
                Step 5<br>Adjustments
            </div>
            <div class="step-indicator" onclick="goToStep(6)">
                Step 6<br>Adj. Trial Bal.
            </div>
            <div class="step-indicator" onclick="goToStep(7)">
                Step 7<br>Statements
            </div>
        </div>

        <!-- Step 1: Transactions -->
        <div id="step1" class="step-content active">
            <div class="step-header">
                <h2>Step 1: Analyze Transactions</h2>
                <p>Review the business transactions for the month</p>
            </div>

            <div class="transaction-list" id="transactionsList"></div>

            <div class="controls">
                <button class="btn btn-primary" onclick="goToStep(2)">Continue to Step 2: Journal Entries ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Journal Entries -->
        <div id="step2" class="step-content">
            <div class="step-header">
                <h2>Step 2: Journalize Transactions</h2>
                <p>Record journal entries for each transaction</p>
            </div>

            <div id="journalEntriesContainer"></div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="goToStep(1)">‚Üê Back</button>
                <button class="btn btn-success" onclick="checkJournalEntries()">Check Entries</button>
                <button class="btn btn-primary" onclick="goToStep(3)">Continue to Step 3: Ledger ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Post to Ledger -->
        <div id="step3" class="step-content">
            <div class="step-header">
                <h2>Step 3: Post to Ledger</h2>
                <p>Manually post each journal entry to the appropriate T-accounts</p>
            </div>

            <div class="feedback info">
                Review your journal entries from Step 2 and post each debit and credit to the ledger accounts below.
            </div>

            <div class="ledger-grid" id="ledgerAccounts"></div>

            <div id="step3-feedback"></div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="goToStep(2)">‚Üê Back</button>
                <button class="btn btn-success" onclick="checkLedgerPostings()">Check Ledger</button>
                <button class="btn btn-primary" onclick="goToStep(4)">Continue to Step 4: Trial Balance ‚Üí</button>
            </div>
        </div>

        <!-- Step 4: Unadjusted Trial Balance -->
        <div id="step4" class="step-content">
            <div class="step-header">
                <h2>Step 4: Prepare Unadjusted Trial Balance</h2>
                <p>Calculate and enter the balance for each account</p>
            </div>

            <div class="feedback info">
                Use your ledger from Step 3 to calculate the ending balance for each account. Enter debit balances in the Debit column and credit balances in the Credit column.
            </div>

            <table class="trial-balance-table" id="unadjustedTB"></table>

            <div id="step4-feedback"></div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="goToStep(3)">‚Üê Back</button>
                <button class="btn btn-success" onclick="checkTrialBalance(false)">Check Trial Balance</button>
                <button class="btn btn-primary" onclick="goToStep(5)">Continue to Step 5: Adjustments ‚Üí</button>
            </div>
        </div>

        <!-- Step 5: Adjusting Entries -->
        <div id="step5" class="step-content">
            <div class="step-header">
                <h2>Step 5: Journalize Adjusting Entries</h2>
                <p>Record end-of-period adjustments</p>
            </div>

            <div class="transaction-list">
                <h3 style="margin-bottom: 15px;">Adjusting Information:</h3>
                <div id="adjustingInfo"></div>
            </div>

            <div id="adjustingEntriesContainer"></div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="goToStep(4)">‚Üê Back</button>
                <button class="btn btn-success" onclick="checkAdjustingEntries()">Check Adjustments</button>
                <button class="btn btn-primary" onclick="goToStep(6)">Continue to Step 6: Adjusted TB ‚Üí</button>
            </div>
        </div>

        <!-- Step 6: Adjusted Trial Balance -->
        <div id="step6" class="step-content">
            <div class="step-header">
                <h2>Step 6: Prepare Adjusted Trial Balance</h2>
                <p>Update account balances after adjustments</p>
            </div>

            <div class="feedback info">
                Take your unadjusted trial balance from Step 4 and update it with the adjusting entries from Step 5. Calculate the new adjusted balance for each account.
            </div>

            <table class="trial-balance-table" id="adjustedTB"></table>

            <div id="step6-feedback"></div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="goToStep(5)">‚Üê Back</button>
                <button class="btn btn-success" onclick="checkTrialBalance(true)">Check Adjusted TB</button>
                <button class="btn btn-primary" onclick="goToStep(7)">Continue to Step 7: Financial Statements ‚Üí</button>
            </div>
        </div>

        <!-- Step 7: Financial Statements -->
        <div id="step7" class="step-content">
            <div class="step-header">
                <h2>Step 7: Prepare Financial Statements</h2>
                <p>Create Income Statement, Statement of Retained Earnings, and Balance Sheet</p>
            </div>

            <div class="feedback info">
                Use your adjusted trial balance from Step 6 to prepare the financial statements below.
            </div>

            <div id="financialStatements"></div>

            <div id="step7-feedback"></div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="goToStep(6)">‚Üê Back</button>
                <button class="btn btn-success" onclick="checkFinancialStatements()">Check Statements</button>
                <button class="btn btn-success" onclick="completeWorkflow()">Complete Cycle! üéâ</button>
            </div>
        </div>

    </div>

    <script>
        let currentStep = 1;
        let scenarioData = null;
        let journalEntries = {};
        let adjustingEntries = {};

        const accounts = [
            '-- Select Account --',
            'Cash', 'Accounts Receivable', 'Supplies', 'Prepaid Insurance', 'Equipment',
            'Accumulated Depreciation', 'Accounts Payable', 'Unearned Revenue',
            'Common Stock', 'Retained Earnings', 'Dividends',
            'Service Revenue', 'Supplies Expense', 'Insurance Expense',
            'Depreciation Expense', 'Salaries Expense', 'Rent Expense'
        ];

        function random(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function fmt(amount) {
            return '$' + amount.toLocaleString();
        }

        function generateScenario() {
            const trans = {
                t1: random(200, 500) * 100,
                t2: random(100, 300) * 100,
                t3: random(50, 200) * 100,
                t4: random(100, 400) * 100,
                t5: random(50, 150) * 100,
                t6: random(80, 200) * 100,
                t7: random(60, 180) * 100,
                t8: random(40, 120) * 100
            };

            // Need initial prepaid insurance for adjustment
            const prepaidInsurance = random(30, 60) * 100;

            const adj = {
                supplies: random(20, trans.t3/100 - 10) * 100,
                insurance: random(10, 40) * 100,
                depreciation: random(50, 150) * 10
            };

            return {
                transactions: [
                    {
                        id: 't1',
                        date: 'Jan 1',
                        desc: `Owner invests ${fmt(trans.t1)} cash in the business`,
                        dr: 'Cash',
                        cr: 'Common Stock',
                        amount: trans.t1
                    },
                    {
                        id: 't2',
                        date: 'Jan 3',
                        desc: `Purchased ${fmt(prepaidInsurance)} insurance policy for 12 months`,
                        dr: 'Prepaid Insurance',
                        cr: 'Cash',
                        amount: prepaidInsurance
                    },
                    {
                        id: 't3',
                        date: 'Jan 5',
                        desc: `Provided services for ${fmt(trans.t2)} cash`,
                        dr: 'Cash',
                        cr: 'Service Revenue',
                        amount: trans.t2
                    },
                    {
                        id: 't4',
                        date: 'Jan 8',
                        desc: `Purchased supplies for ${fmt(trans.t3)} cash`,
                        dr: 'Supplies',
                        cr: 'Cash',
                        amount: trans.t3
                    },
                    {
                        id: 't5',
                        date: 'Jan 12',
                        desc: `Provided services for ${fmt(trans.t4)} on account`,
                        dr: 'Accounts Receivable',
                        cr: 'Service Revenue',
                        amount: trans.t4
                    },
                    {
                        id: 't6',
                        date: 'Jan 15',
                        desc: `Paid ${fmt(trans.t5)} rent for the month`,
                        dr: 'Rent Expense',
                        cr: 'Cash',
                        amount: trans.t5
                    },
                    {
                        id: 't7',
                        date: 'Jan 20',
                        desc: `Collected ${fmt(trans.t6)} from customers`,
                        dr: 'Cash',
                        cr: 'Accounts Receivable',
                        amount: trans.t6
                    },
                    {
                        id: 't8',
                        date: 'Jan 25',
                        desc: `Received ${fmt(trans.t7)} cash in advance for future services`,
                        dr: 'Cash',
                        cr: 'Unearned Revenue',
                        amount: trans.t7
                    },
                    {
                        id: 't9',
                        date: 'Jan 31',
                        desc: `Paid ${fmt(trans.t8)} for employee salaries`,
                        dr: 'Salaries Expense',
                        cr: 'Cash',
                        amount: trans.t8
                    }
                ],
                adjustments: [
                    {
                        id: 'adj1',
                        desc: `Supplies used during the month: ${fmt(adj.supplies)}`,
                        dr: 'Supplies Expense',
                        cr: 'Supplies',
                        amount: adj.supplies
                    },
                    {
                        id: 'adj2',
                        desc: `One month of prepaid insurance expired: ${fmt(adj.insurance)}`,
                        dr: 'Insurance Expense',
                        cr: 'Prepaid Insurance',
                        amount: adj.insurance
                    },
                    {
                        id: 'adj3',
                        desc: `Monthly depreciation on equipment: ${fmt(adj.depreciation)}`,
                        dr: 'Depreciation Expense',
                        cr: 'Accumulated Depreciation',
                        amount: adj.depreciation
                    }
                ]
            };
        }

        function initializeScenario() {
            scenarioData = generateScenario();
            renderStep1();
            renderStep2();
            renderStep5();
        }

        function renderStep1() {
            const container = document.getElementById('transactionsList');
            container.innerHTML = '<h3 style="margin-bottom: 15px; color: #374151;">January Transactions:</h3>' +
                scenarioData.transactions.map(t => `
                    <div class="transaction-item">
                        <div class="transaction-date">${t.date}</div>
                        <div>${t.desc}</div>
                    </div>
                `).join('');
        }

        function renderStep2() {
            const container = document.getElementById('journalEntriesContainer');
            container.innerHTML = scenarioData.transactions.map((t, idx) => `
                <div class="journal-entry-builder">
                    <h4 style="margin-bottom: 15px; color: #374151;">${t.date}: ${t.desc}</h4>
                    <div class="entry-row">
                        <span class="entry-label">Debit:</span>
                        <select id="${t.id}-dr">
                            ${accounts.map(a => `<option value="${a}">${a}</option>`).join('')}
                        </select>
                        <input type="number" id="${t.id}-dr-amt" placeholder="Amount">
                    </div>
                    <div class="entry-row">
                        <span class="entry-label">Credit:</span>
                        <select id="${t.id}-cr">
                            ${accounts.map(a => `<option value="${a}">${a}</option>`).join('')}
                        </select>
                        <input type="number" id="${t.id}-cr-amt" placeholder="Amount">
                    </div>
                    <div id="${t.id}-feedback" style="margin-top: 10px;"></div>
                </div>
            `).join('');
        }

        function renderStep5() {
            document.getElementById('adjustingInfo').innerHTML = scenarioData.adjustments.map(a => `
                <div class="transaction-item">${a.desc}</div>
            `).join('');

            document.getElementById('adjustingEntriesContainer').innerHTML = scenarioData.adjustments.map(a => `
                <div class="journal-entry-builder">
                    <h4 style="margin-bottom: 15px; color: #374151;">${a.desc}</h4>
                    <div class="entry-row">
                        <span class="entry-label">Debit:</span>
                        <select id="${a.id}-dr">
                            ${accounts.map(acc => `<option value="${acc}">${acc}</option>`).join('')}
                        </select>
                        <input type="number" id="${a.id}-dr-amt" placeholder="Amount">
                    </div>
                    <div class="entry-row">
                        <span class="entry-label">Credit:</span>
                        <select id="${a.id}-cr">
                            ${accounts.map(acc => `<option value="${acc}">${acc}</option>`).join('')}
                        </select>
                        <input type="number" id="${a.id}-cr-amt" placeholder="Amount">
                    </div>
                    <div id="${a.id}-feedback" style="margin-top: 10px;"></div>
                </div>
            `).join('');
        }

        function goToStep(step) {
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.step-indicator').forEach(s => s.classList.remove('active'));

            document.getElementById(`step${step}`).classList.add('active');
            document.querySelectorAll('.step-indicator')[step - 1].classList.add('active');

            currentStep = step;

            if (step === 3) renderStep3();
            if (step === 4) renderStep4();
            if (step === 6) renderStep6();
            if (step === 7) renderStep7();

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function checkJournalEntries() {
            let allCorrect = true;

            scenarioData.transactions.forEach(t => {
                const drAccount = document.getElementById(`${t.id}-dr`).value;
                const drAmount = parseFloat(document.getElementById(`${t.id}-dr-amt`).value) || 0;
                const crAccount = document.getElementById(`${t.id}-cr`).value;
                const crAmount = parseFloat(document.getElementById(`${t.id}-cr-amt`).value) || 0;

                const feedback = document.getElementById(`${t.id}-feedback`);

                if (drAccount === t.dr && crAccount === t.cr && drAmount === t.amount && crAmount === t.amount) {
                    feedback.className = 'feedback success';
                    feedback.textContent = '‚úì Correct!';
                    journalEntries[t.id] = { dr: drAccount, cr: crAccount, amount: t.amount };
                } else {
                    allCorrect = false;
                    feedback.className = 'feedback error';
                    feedback.innerHTML = `‚úó Check your entry. Correct: DR ${t.dr} ${fmt(t.amount)}, CR ${t.cr} ${fmt(t.amount)}`;
                }
            });

            if (allCorrect) {
                markStepCompleted(2);
            }
        }

        function checkAdjustingEntries() {
            let allCorrect = true;

            scenarioData.adjustments.forEach(a => {
                const drAccount = document.getElementById(`${a.id}-dr`).value;
                const drAmount = parseFloat(document.getElementById(`${a.id}-dr-amt`).value) || 0;
                const crAccount = document.getElementById(`${a.id}-cr`).value;
                const crAmount = parseFloat(document.getElementById(`${a.id}-cr-amt`).value) || 0;

                const feedback = document.getElementById(`${a.id}-feedback`);

                if (drAccount === a.dr && crAccount === a.cr && drAmount === a.amount && crAmount === a.amount) {
                    feedback.className = 'feedback success';
                    feedback.textContent = '‚úì Correct!';
                    adjustingEntries[a.id] = { dr: drAccount, cr: crAccount, amount: a.amount };
                } else {
                    allCorrect = false;
                    feedback.className = 'feedback error';
                    feedback.innerHTML = `‚úó Check your entry. Correct: DR ${a.dr} ${fmt(a.amount)}, CR ${a.cr} ${fmt(a.amount)}`;
                }
            });

            if (allCorrect) {
                markStepCompleted(5);
            }
        }

        // Step 3: Manual ledger posting
        function renderStep3() {
            const allAccounts = new Set();
            scenarioData.transactions.forEach(t => {
                allAccounts.add(t.dr);
                allAccounts.add(t.cr);
            });

            const container = document.getElementById('ledgerAccounts');
            container.innerHTML = Array.from(allAccounts).sort().map(accountName => `
                <div class="t-account">
                    <div class="t-account-header">${accountName}</div>
                    <div class="t-account-body">
                        <div class="debit-side">
                            <div class="side-label">Debit</div>
                            <div id="${accountName}-debits"></div>
                        </div>
                        <div class="credit-side">
                            <div class="side-label">Credit</div>
                            <div id="${accountName}-credits"></div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Create input fields for each transaction posting
            scenarioData.transactions.forEach((t, idx) => {
                const drDiv = document.getElementById(`${t.dr}-debits`);
                const crDiv = document.getElementById(`${t.cr}-credits`);

                drDiv.innerHTML += `
                    <div class="ledger-input-row">
                        <label>${t.date}:</label>
                        <input type="number" id="ledger-${t.id}-dr" placeholder="Amount">
                    </div>
                `;

                crDiv.innerHTML += `
                    <div class="ledger-input-row">
                        <label>${t.date}:</label>
                        <input type="number" id="ledger-${t.id}-cr" placeholder="Amount">
                    </div>
                `;
            });
        }

        function checkLedgerPostings() {
            let allCorrect = true;
            let errors = [];

            scenarioData.transactions.forEach(t => {
                const drInput = document.getElementById(`ledger-${t.id}-dr`);
                const crInput = document.getElementById(`ledger-${t.id}-cr`);

                const drValue = parseFloat(drInput.value) || 0;
                const crValue = parseFloat(crInput.value) || 0;

                if (drValue !== t.amount) {
                    allCorrect = false;
                    errors.push(`${t.date}: ${t.dr} debit should be ${fmt(t.amount)}`);
                    drInput.style.borderColor = '#ef4444';
                } else {
                    drInput.style.borderColor = '#10b981';
                }

                if (crValue !== t.amount) {
                    allCorrect = false;
                    errors.push(`${t.date}: ${t.cr} credit should be ${fmt(t.amount)}`);
                    crInput.style.borderColor = '#ef4444';
                } else {
                    crInput.style.borderColor = '#10b981';
                }
            });

            const feedbackDiv = document.getElementById('step3-feedback');
            if (allCorrect) {
                feedbackDiv.className = 'feedback success';
                feedbackDiv.innerHTML = '<strong>‚úì All ledger postings are correct!</strong>';
                markStepCompleted(3);
            } else {
                feedbackDiv.className = 'feedback error';
                feedbackDiv.innerHTML = '<strong>‚úó Some postings need correction:</strong><br>' + errors.join('<br>');
            }
        }

        // Step 4: Manual trial balance
        function calculateBalances(includeAdjustments = false) {
            const balances = {};

            scenarioData.transactions.forEach(t => {
                if (!balances[t.dr]) balances[t.dr] = 0;
                if (!balances[t.cr]) balances[t.cr] = 0;
                balances[t.dr] += t.amount;
                balances[t.cr] -= t.amount;
            });

            if (includeAdjustments) {
                scenarioData.adjustments.forEach(a => {
                    if (!balances[a.dr]) balances[a.dr] = 0;
                    if (!balances[a.cr]) balances[a.cr] = 0;
                    balances[a.dr] += a.amount;
                    balances[a.cr] -= a.amount;
                });
            }

            return balances;
        }

        function renderStep4() {
            const accountList = Array.from(new Set([
                ...scenarioData.transactions.map(t => t.dr),
                ...scenarioData.transactions.map(t => t.cr)
            ])).sort();

            const rows = accountList.map(account => `
                <tr>
                    <td>${account}</td>
                    <td>
                        <input type="number" class="tb-input" id="tb-${account}-dr" placeholder="Debit">
                    </td>
                    <td>
                        <input type="number" class="tb-input" id="tb-${account}-cr" placeholder="Credit">
                    </td>
                </tr>
            `).join('');

            document.getElementById('unadjustedTB').innerHTML = `
                <thead>
                    <tr>
                        <th>Account</th>
                        <th style="text-align: right;">Debit</th>
                        <th style="text-align: right;">Credit</th>
                    </tr>
                </thead>
                <tbody>
                    ${rows}
                    <tr class="total-row">
                        <td>Totals</td>
                        <td id="tb-total-dr" style="text-align: right; font-family: 'Courier New', monospace;">‚Äî</td>
                        <td id="tb-total-cr" style="text-align: right; font-family: 'Courier New', monospace;">‚Äî</td>
                    </tr>
                </tbody>
            `;
        }

        function checkTrialBalance(isAdjusted) {
            const balances = calculateBalances(isAdjusted);
            const accountList = Object.keys(balances).sort();

            let allCorrect = true;
            let errors = [];
            let totalDr = 0;
            let totalCr = 0;

            accountList.forEach(account => {
                const balance = balances[account];
                const expectedDr = balance > 0 ? balance : 0;
                const expectedCr = balance < 0 ? -balance : 0;

                const drInput = document.getElementById(`tb${isAdjusted ? '2' : ''}-${account}-dr`);
                const crInput = document.getElementById(`tb${isAdjusted ? '2' : ''}-${account}-cr`);

                const actualDr = parseFloat(drInput.value) || 0;
                const actualCr = parseFloat(crInput.value) || 0;

                totalDr += actualDr;
                totalCr += actualCr;

                if (actualDr !== expectedDr || actualCr !== expectedCr) {
                    allCorrect = false;
                    errors.push(`${account}: Expected DR ${fmt(expectedDr)}, CR ${fmt(expectedCr)}`);
                    if (actualDr !== expectedDr) drInput.style.borderColor = '#ef4444';
                    if (actualCr !== expectedCr) crInput.style.borderColor = '#ef4444';
                } else {
                    drInput.style.borderColor = '#10b981';
                    crInput.style.borderColor = '#10b981';
                }
            });

            // Update totals
            document.getElementById(`tb${isAdjusted ? '2' : ''}-total-dr`).textContent = fmt(totalDr);
            document.getElementById(`tb${isAdjusted ? '2' : ''}-total-cr`).textContent = fmt(totalCr);

            const feedbackDiv = document.getElementById(`step${isAdjusted ? '6' : '4'}-feedback`);
            if (allCorrect && totalDr === totalCr) {
                feedbackDiv.className = 'feedback success';
                feedbackDiv.innerHTML = '<strong>‚úì Trial balance is correct and balanced!</strong>';
                markStepCompleted(isAdjusted ? 6 : 4);
            } else {
                feedbackDiv.className = 'feedback error';
                let msg = '<strong>‚úó Issues found:</strong><br>';
                if (totalDr !== totalCr) msg += `Trial balance does not balance! DR ${fmt(totalDr)} ‚â† CR ${fmt(totalCr)}<br>`;
                if (errors.length > 0) msg += errors.join('<br>');
                feedbackDiv.innerHTML = msg;
            }
        }

        function renderStep6() {
            const accountList = Array.from(new Set([
                ...scenarioData.transactions.map(t => t.dr),
                ...scenarioData.transactions.map(t => t.cr),
                ...scenarioData.adjustments.map(a => a.dr),
                ...scenarioData.adjustments.map(a => a.cr)
            ])).sort();

            const rows = accountList.map(account => `
                <tr>
                    <td>${account}</td>
                    <td>
                        <input type="number" class="tb-input" id="tb2-${account}-dr" placeholder="Debit">
                    </td>
                    <td>
                        <input type="number" class="tb-input" id="tb2-${account}-cr" placeholder="Credit">
                    </td>
                </tr>
            `).join('');

            document.getElementById('adjustedTB').innerHTML = `
                <thead>
                    <tr>
                        <th>Account</th>
                        <th style="text-align: right;">Debit</th>
                        <th style="text-align: right;">Credit</th>
                    </tr>
                </thead>
                <tbody>
                    ${rows}
                    <tr class="total-row">
                        <td>Totals</td>
                        <td id="tb2-total-dr" style="text-align: right; font-family: 'Courier New', monospace;">‚Äî</td>
                        <td id="tb2-total-cr" style="text-align: right; font-family: 'Courier New', monospace;">‚Äî</td>
                    </tr>
                </tbody>
            `;
        }

        // Step 7: Manual financial statements
        function renderStep7() {
            document.getElementById('financialStatements').innerHTML = `
                <div class="fs-section">
                    <h3 style="color: #3b82f6; margin-bottom: 20px; text-align: center;">Income Statement</h3>
                    <div class="fs-line">
                        <strong>Service Revenue:</strong>
                        <input type="number" id="fs-revenue" placeholder="Amount">
                    </div>
                    <div class="fs-line">
                        <strong>Total Expenses:</strong>
                        <input type="number" id="fs-expenses" placeholder="Amount">
                    </div>
                    <div class="fs-line" style="background: #dbeafe; font-weight: 700;">
                        <strong>Net Income:</strong>
                        <input type="number" id="fs-netincome" placeholder="Amount">
                    </div>
                </div>

                <div class="feedback info">
                    <strong>Hint:</strong> Total expenses = Rent + Salaries + Supplies + Insurance + Depreciation expenses
                </div>
            `;
        }

        function checkFinancialStatements() {
            const balances = calculateBalances(true);

            let revenues = 0;
            let expenses = 0;

            Object.keys(balances).forEach(account => {
                if (account.includes('Revenue') && !account.includes('Unearned')) {
                    revenues += Math.abs(balances[account]);
                } else if (account.includes('Expense')) {
                    expenses += Math.abs(balances[account]);
                }
            });

            const netIncome = revenues - expenses;

            const revenueInput = parseFloat(document.getElementById('fs-revenue').value) || 0;
            const expensesInput = parseFloat(document.getElementById('fs-expenses').value) || 0;
            const netIncomeInput = parseFloat(document.getElementById('fs-netincome').value) || 0;

            let allCorrect = true;
            let errors = [];

            if (revenueInput !== revenues) {
                allCorrect = false;
                errors.push(`Service Revenue should be ${fmt(revenues)}`);
                document.getElementById('fs-revenue').style.borderColor = '#ef4444';
            } else {
                document.getElementById('fs-revenue').style.borderColor = '#10b981';
            }

            if (expensesInput !== expenses) {
                allCorrect = false;
                errors.push(`Total Expenses should be ${fmt(expenses)}`);
                document.getElementById('fs-expenses').style.borderColor = '#ef4444';
            } else {
                document.getElementById('fs-expenses').style.borderColor = '#10b981';
            }

            if (netIncomeInput !== netIncome) {
                allCorrect = false;
                errors.push(`Net Income should be ${fmt(netIncome)}`);
                document.getElementById('fs-netincome').style.borderColor = '#ef4444';
            } else {
                document.getElementById('fs-netincome').style.borderColor = '#10b981';
            }

            const feedbackDiv = document.getElementById('step7-feedback');
            if (allCorrect) {
                feedbackDiv.className = 'feedback success';
                feedbackDiv.innerHTML = '<strong>‚úì Financial statements are correct! üéâ</strong>';
                markStepCompleted(7);
            } else {
                feedbackDiv.className = 'feedback error';
                feedbackDiv.innerHTML = '<strong>‚úó Issues found:</strong><br>' + errors.join('<br>');
            }
        }

        function markStepCompleted(step) {
            document.querySelectorAll('.step-indicator')[step - 1].classList.add('completed');
        }

        function completeWorkflow() {
            const completedSteps = document.querySelectorAll('.step-indicator.completed').length;
            if (completedSteps === 7) {
                alert('üéâ Congratulations! You have successfully completed all 7 steps of the accounting cycle!\n\n‚úì Analyzed transactions\n‚úì Journalized entries\n‚úì Posted to the ledger\n‚úì Prepared unadjusted trial balance\n‚úì Recorded adjusting entries\n‚úì Prepared adjusted trial balance\n‚úì Created financial statements\n\nYou now understand the complete accounting workflow!');
            } else {
                alert(`You've completed ${completedSteps} out of 7 steps. Make sure to check all your work before finishing!`);
            }
        }

        function resetScenario() {
            // Clear all completed indicators
            document.querySelectorAll('.step-indicator').forEach(indicator => {
                indicator.classList.remove('completed');
            });

            // Clear all feedback divs
            document.querySelectorAll('.feedback').forEach(fb => {
                fb.innerHTML = '';
                fb.className = 'feedback';
            });

            // Reset journal and adjusting entries
            journalEntries = {};
            adjustingEntries = {};

            // Generate new scenario
            scenarioData = generateScenario();

            // Re-render initial steps
            renderStep1();
            renderStep2();
            renderStep5();

            // Go back to step 1
            goToStep(1);

            // Show notification
            const notification = document.createElement('div');
            notification.className = 'feedback success';
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.zIndex = '1000';
            notification.style.minWidth = '300px';
            notification.textContent = '‚úì New scenario generated!';
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.transition = 'opacity 0.3s';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        window.addEventListener('load', function() {
            initializeScenario();
        });
    </script>
</body>
</html>